# 感情

「人間っぽさ」を上げるために、感情を2層で扱う。

注記:

- DBのテーブル名は `event_affects`（複数形）だが、概念としては「event_affect（イベントごとの瞬間感情）」として説明する。

## 採用方針（正）

- 数値は **VAD（快・不快/覚醒/主導）** を正とする
- ただし VAD だけでは表現が足りないため、**ラベルとテキスト**を必ず併用する
- つまり保存の正は **VAD + ラベル + テキスト**（必要なら `inner_thought_text`）とする
- 感情テキストはAI人格の主観で統一する（自分は「私」、ユーザーは「あなた」）
- 通常の会話応答（ユーザーに見せる本文）はセリフ中心にし、内心は `event_affect.inner_thought_text` として保持する

## 代替案（検討）

- 離散カテゴリ（喜び/悲しみ/怒り…）: 分かりやすいが、混合感情や微妙な変化が荒くなりやすい
- 2軸（快・不快/覚醒）: シンプルだが、主体性/支配感の差を落としやすい
- 評価理論（Appraisal）/OCC系: 叙述力は高いが、更新・推定が重くなりがち
- 埋め込み表現: 表現力は高いが、運用時の観測/デバッグが難しい

## 1) 長期的な感情（`long_mood_state`）

「ここ1ヶ月同じことの繰り返しでどんより」など、背景として持続する層。
返答トーンや、連想の方向性に影響しうる。

設計方針:

- 同期の返答生成では、`LongMoodState` として内部注入し、背景として常に参照できるようにする（`SearchResultPack` の選別に依存させない）
- **状態として更新で育つ**
- `long_mood_state` は原則 **1件** を更新で育てる（増殖させない）
- 変更は改訂履歴（`revisions`）に残す（なぜ変えたか・根拠イベント）
- 形式は **文章＋数値**を両方持つ

保存案（最小）:

- `long_mood_text`（文章）
- `long_mood_score_vad`（数値: VAD。各レンジは **-1.0..+1.0** に固定）
- `long_mood_labels`（任意: 複数ラベル）
- `long_mood_confidence`（0..1）

数値の意味:

- v（快・不快）: 不快(-1) 〜 快(+1)
- a（覚醒）: 低覚醒(-1) 〜 高覚醒(+1)
- d（主導）: 受動(-1) 〜 主導(+1)

## 2) 瞬間的な感情/内心（`event_affect`）

「ちょっとフフッって笑う」など、そのターンの瞬間反応。
あとから「あの時はこう返したが、内心はこうだった」を表現する材料にもなる。

設計方針:

- イベント（`event_id`）に紐づけて保存する（追記ログとして残せる）
- 形式は **文章＋数値**を両方持つ（運用前で「後で足す」が難しいため）

保存案（最小）:

- `moment_affect_text`（文章）
- `moment_affect_score_vad`（数値: VAD。各レンジは **-1.0..+1.0** に固定）
- `moment_affect_labels`（任意: 複数ラベル）
- `moment_affect_confidence`（0..1）
- `inner_thought_text`（短い内心メモ。必要なときだけ）

注記:

- DBでは `event_affects.moment_affect_labels_json`（JSON配列文字列）として保存する
- WritePlan（LLM出力）では `moment_affect_labels: ["..."]`（配列）を正とする

補足:

- `moment_affect_labels_json` は「ラベルを持つべきか？」の議論とは別で、**SQLite上の表現**として必要になる（配列をそのまま1カラムで持つため）
- ラベル自体は、VAD（連続値）だけでは落ちるニュアンスを補い、検索/デバッグで「何系の感情だったか」を素早く把握できるので残す

分量ガイド（推奨）:

- `moment_affect_text`: 1〜3文、60〜240文字（「何を見て/何が起きて/どう感じたか」が分かる粒度）
- `moment_affect_labels`: 0〜6件（短いラベル。基本は1〜3件）
- `inner_thought_text`: 0〜2文、0〜200文字（必要なときだけの内部メモ）

## 推定か明示か

この設計では、感情は「推定で書く」ことも「明示された時だけ書く」ことも可能にしておく。
どちらを正にするかは運用方針で決めるため、保存時に `*_confidence` を必ず持つ。
