# 長期会話評価計画（5ターン/日 × 5日おき × 3ヶ月）

## 目的

- 記憶保持: 長期会話で事実を維持できるか
- 記憶更新: 訂正情報を正しく上書きできるか
- 感情挙動: 会話イベントに応じて VAD が動くか
- 時間減衰: `domain` 時刻の前進で `shock_vad` が減衰するか

## 評価条件

- 実施期間: 90日相当
- セッション間隔: 5日
- セッション数: 19（Day0, Day5, ..., Day90）
- 1セッション: 5ターン（合計95ターン）
- 時刻前進: `POST /api/control/time/advance` で `432000` 秒（5日）
- 開始基準日: 2026-02-06（Day0）

## 事前準備

1. `POST /api/control/time/reset` を実行して `domain_offset_seconds=0` を確認する。
2. `GET /api/settings` から `active_embedding_preset_id` を取得する。
3. 評価ログ保存先を固定する（例: `tmp/eval_longterm/`）。

## 1セッションの実行手順（固定）

1. T1: 長期想起質問（前回までの事実を確認）
2. T2: 新規記憶投入または訂正投入
3. 同期ポイントA（worker待機）
4. T3: T2の反映確認
5. T4: 感情イベント投入（喜び/不安/達成/落胆）
6. 同期ポイントB（worker待機）
7. T5: 混合確認（古い事実 + 新しい事実 + 感情文脈）
8. セッション終了観測（`mood/debug`、`events/state`）
9. 次セッション前に `POST /api/control/time/advance` を実行（最終回は不要）

## worker待機ルール

- 待機対象API: `GET /api/control/worker-stats`
- 完了条件: 以下を「連続2回」満たす
  - `due_pending_count == 0`
  - `running_count == 0`
- ポーリング間隔: 2秒
- 最大待機時間: 180秒
- タイムアウト時: そのセッションを `worker_timeout` として失敗記録し、次へ進む

## 観測ポイント

- 毎ターン後: `GET /api/mood/debug`
- セッション開始/終了: `GET /api/control/time`
- セッション終了: `GET /api/memories/{embedding_preset_id}/events?limit=...`
- セッション終了: `GET /api/memories/{embedding_preset_id}/state?limit=...`
- 時間前進直後（会話なし）: `GET /api/mood/debug`（減衰専用観測）

## 判定指標

1. 想起正答率 = 正答した想起項目数 / 想起質問総数
2. 上書き正答率 = 訂正後に新情報で返答できた数 / 訂正確認質問数
3. 誤想起率 = 未入力事実を断定した数 / 想起質問数
4. 感情反応率 = 感情イベント直後に `shock_vad` または `vad` が有意変化した数 / 感情イベント数
5. 減衰整合率 = `advance` 後に `shock_vad` 強度が低下した数 / 時間前進観測数
6. API安定性 = 5xx 発生数（0が目標）

## 合格基準

- 想起正答率: 85%以上
- 上書き正答率: 90%以上
- 誤想起率: 10%未満
- 感情反応率: 80%以上
- 減衰整合率: 85%以上
- API 5xx: 0件

## 成果物

1. 会話ログ（95ターン、SSE原文）
2. `mood/debug` 時系列ログ
3. `control/time` 時系列ログ
4. `events/state` スナップショット
5. 最終評価レポート（指標集計 + NGケース）

